#!/usr/bin/env php
<?php

require_once "../vendor/autoload.php";

use Idnan\Tevo\Movies;
use Idnan\Tevo\Tevo;

// get options
$options = getopt('', [
    'upcoming',
    'now_playing',
    'popular',
    'top_rated',
    'search',
    'page::',
    'query::',
]);

if (!isset($options['upcoming']) &&
    !isset($options['now_playing']) &&
    !isset($options['popular']) &&
    !isset($options['top_rated']) &&
    !isset($options['search'])) {
    echo '[FAIL] Invalid command' . PHP_EOL;
    exit(1);
}

if (isset($options['search']) && empty(trim($options['query']))) {
    echo '[FAIL] Query is required' . PHP_EOL;
    exit(1);
}

$page = !empty($options['page']) ? (intval($options['page']) == 0 ? 1 : intval($options['page'])) : 1;

$movies = new Movies($page);
$tevo = new Tevo($movies);

if (isset($options['upcoming'])) {
    $tevo->getUpcoming();
} else if (isset($options['top_rated'])) {
    $tevo->getTopRated();
} else if (isset($options['popular'])) {
    $tevo->getPopular();
} else if (isset($options['now_playing'])) {
    $tevo->getNowPlaying();
} else if (isset($options['search'])) {
    $query = urlencode($options['query']);
    $tevo->search($query);
}
